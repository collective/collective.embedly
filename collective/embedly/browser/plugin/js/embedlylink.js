function preinit(){var a;if(a=tinyMCEPopup.getParam("external_link_list_url"))document.write('<script language="javascript" type="text/javascript" src="'+tinyMCEPopup.editor.documentBaseURI.toAbsolute(a)+'"></script>')}function initData(a){var b=a.split("?");if(b.length===2){var c=b[1].split("&"),d={},e=[],f=[];for(var g in c){var h=c[g].split("=");d[h[0]]=h[1]}for(var g in value_getter){if(value_getter[g]in d){document.getElementById(value_getter[g]).value=d[value_getter[g]];e.push(value_getter[g])}}for(var g in cheched_getter){if(cheched_getter[g]in d){document.getElementById(cheched_getter[g]).checked=true;e.push(cheched_getter[g])}}for(var g in d){if(e.indexOf(g)===-1){f.push(g+"="+d[g])}}b[1]=f.join("&");a=b.join("?")}return a}function init(){tinyMCEPopup.resizeToInnerSize();var formGeneralObj=document.forms[0];var formAdvancedObj=document.forms[1];var formButtonsObj=document.forms[2];var inst=tinyMCEPopup.editor;var elm=inst.selection.getNode();var action="insert";var html;labels=eval(inst.getParam("labels"));elm=inst.dom.getParent(elm,"A");if(elm!=null&&elm.nodeName=="A")action="update";formButtonsObj.insert.value="Insert";if(tinyMCEPopup.editor.settings.rooted){document.getElementById("home").style.display="none"}if(action=="update"){var href=inst.dom.getAttrib(elm,"href");href=tinymce.trim(href);setFormValue("href",href,0);if(typeof elm.title!="undefined"&&elm.title!=""){setFormValue("title",inst.dom.getAttrib(elm,"title"),2)}href=initData(href);setFormValue("externalurl",href,0)}else{href=inst.selection.getContent();href=tinymce.trim(href);if(href.indexOf("http")==0)setFormValue("externalurl",href,0)}}function getParentUrl(a){var b=a.split("/");b.pop();return b.join("/")}function getAbsoluteUrl(a,b){if(b.indexOf("http://")!=-1||b.indexOf("https://")!=-1||b.indexOf("ftp://")!=-1){return b}var c=a.split("/");var d=b.split("/");c.pop();while(d.length!=0){var e=d.shift();if(e=="."){}else if(e==".."){c.pop()}else{c.push(e)}}return c.join("/")}function setFormValue(a,b,c){document.forms[c].elements[a].value=b}function setAttrib(a,b,c,d){var e=document.forms[d];var f=e.elements[b.toLowerCase()];var g=tinyMCEPopup.editor.dom;if(typeof c=="undefined"||c==null){c="";if(f)c=f.value}g.setAttrib(a,b,c)}function previewExternalLink(){var url=document.getElementById("externalurl").value;elink="http://api.embed.ly/v1/api/oembed?format=json";params={};params["url"]=escape(url);for(var i in params){if(params[i])elink+="&"+i+"="+params[i]}var request=new XMLHttpRequest;var preview=document.getElementById("previewexternal");request.open("GET",elink,true);request.onreadystatechange=function(){if(request.readyState==request.DONE){if(request.status==200){var resp=eval("("+request.responseText+")");if(resp.type=="error"){preview.innerHTML="<p class='error'>We couldn't process this URL. Try again, or email support@embed.ly.</p>"}else{if(resp.type==="photo"){code='<a href="'+url+'" target="_blank"><img style="width:100%" src="'+resp.url+'" title="'+resp.title||document.title+'" /></a>'}else if(resp.type==="video"){code=resp.html}else if(resp.type==="rich"){code=resp.html}else{thumb=resp.thumbnail_url?'<img src="'+resp.thumbnail_url+'" class="thumb embedly-thumbnail-small" />':"";description=resp.description;code=thumb+"<a class='embedly-title' href='"+url+"'>"+title+"</a>";code+=description}pr='<div class="embedly">'+code+'<div class="embedly-clear"></div>';pr+='<div class="media-attribution"><span>via </span><a href="'+resp.provider_url+'" class="media-attribution-link" target="_blank">'+resp.provider_name+"</a></span></div>";pr+='<div class="embedly-clear"></div></div>';preview.innerHTML=pr}}else{preview.innerHTML="<p class='error'>We couldn't process this URL. Try again, or email support@embed.ly.</p>"}request=null}};request.send()}function getInputValue(a,b){return document.forms[b].elements[a].value}function buildHref(){var a="",b=[],c,d,e;var f=tinyMCEPopup.editor;a=document.getElementById("externalurl").value;for(var e in value_getter){var g=document.getElementById(value_getter[e]).value;if(g!="")b[value_getter[e]]=g}for(var e in cheched_getter){var g=document.getElementById(cheched_getter[e]).checked;if(g)b[cheched_getter[e]]="true"}for(var e in b){if(a.indexOf("?")===-1){a+="?"}else{a+="&"}a+=e+"="+b[e]}document.forms[0].href.value=a}function insertAction(){var a=tinyMCEPopup.editor;var b,c,d;buildHref();b=a.selection.getNode();b=a.dom.getParent(b,"A");if(!document.forms[0].href.value){tinyMCEPopup.execCommand("mceBeginUndoLevel");d=a.selection.getBookmark();a.dom.remove(b,1);a.selection.moveToBookmark(d);tinyMCEPopup.execCommand("mceEndUndoLevel");tinyMCEPopup.close();return}tinyMCEPopup.execCommand("mceBeginUndoLevel");if(b==null){a.getDoc().execCommand("unlink",false,null);tinyMCEPopup.execCommand("CreateLink",false,"#mce_temp_url#",{skip_undo:1});c=tinymce.grep(a.dom.select("a"),function(b){return a.dom.getAttrib(b,"href")=="#mce_temp_url#"});for(d=0;d<c.length;d++)setAllAttribs(b=c[d])}else setAllAttribs(b);if(b&&(b.childNodes.length!=1||b.firstChild.nodeName!="IMG")){a.focus();a.selection.select(b);a.selection.collapse(0);tinyMCEPopup.storeSelection()}tinyMCEPopup.execCommand("mceEndUndoLevel");tinyMCEPopup.close()}function setAllAttribs(a){var b=document.forms[0];var c=document.forms[1];var d=document.forms[2];var e=b.href.value;setAttrib(a,"href",e,0);setAttrib(a,"title",c.title.value,2);var f=tinyMCEPopup.editor.dom;f.addClass(a,"embedlylink");if(tinyMCE.isMSIE5)a.outerHTML=a.outerHTML}function getSelectValue(a,b){var c=a.elements[b];if(!c||c.options==null||c.selectedIndex==-1)return"";return c.options[c.selectedIndex].value}var templates={"window.open":"window.open('${url}','${target}','${options}')"};var current_path;var current_link="";var current_url="";var current_pageanchor="";var labels="";var value_getter=["maxwidth","maxheight","width","callback","wmode","words","chars"];var cheched_getter=["allowscripts","nostyle","autoplay","videosrc"];preinit();tinyMCEPopup.onInit.add(init);